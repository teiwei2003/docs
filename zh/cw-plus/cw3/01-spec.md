# CW3 规范:多重签名/投票合约

[CW3](https://github.com/CosmWasm/cosmwasm-plus/tree/master/packages/cw3) 是基于 CosmWasm 的投票合约规范.
它是 CW1(作为 N 个多重签名的直接 1)的扩展.
在这种情况下，没有密钥可以立即执行，而只能提出
一组用于执行的消息.该提案，随后
批准和签名聚合都发生在链上.

我们希望在本规范中涵盖至少 3 种不同的情况:

- N 个不可变多重签名的 K.一个键提出一组消息，
  K-1 其他人批准后，可以执行
  多重签名地址.
- K of N 灵活、可变的多重签名.像上面一样，但与
  多个合同.一份合约存储组，即
  引用自多个多重签名合约(反过来
  实施 cw3).一份 cw3 合约能够更新
  组内容(可能需要 67% 的投票).其他 cw3 合同
  可能持有各种执行的代币、抵押权等
  阈值，全部由一组控制. (群组界面
  更新它们将在未来的规范中定义，可能是 cw4).

这应该适合这个界面(可能有一些
件的扩展，但用法应该看起来
外部相同):

- 代币加权投票.人们在合约中锁定代币
  为投票权.有一个投票门槛来执行
  消息.投票集是动态的.这有一个类似的
  “提议、批准、执行”流程，但我们需要
  支持明确的 YES/NO 投票和 quora 不仅仅是绝对的
  阈值.

共同点是它们允许您提出
任意`CosmosMsg` 到一个合约，并允许一个系列
决定是否可以执行的投票/批准，
以及执行任何已批准提案的最后一步.

## 根据

所有cw3都必须实现以下接口
合同.注意更新投票成员
此处不包含合同(cw4 中定义了一种方法).
此外，如何更改阈值规则(如果有的话)不是
标准化.这些被认为是管理任务，而常见的
API 是为标准使用而设计的，因为这是我们可以
标准化最多的工具而不限制更复杂的
治理控制.

### 消息

`提议{标题，描述，消息，最早，最新}` - 这接受
`Vec<CosmosMsg>` 并创建一个新提案.这将返回
“数据”字段(和日志)中自动生成的 ID
以后可以参考提案.

如果提案人是提案的有效投票者，这将意味着投赞成票
Proposer 可加快工作流程，尤其适用于例如. 3 个中的 2 个
或者 5 个多重签名中的 3 个，我们不需要在一个区块中提出，得到结果，
并在另一个区块投票.

最早和最新是可选的，可以请求第一个
以及我们可以尝试“执行”的最后高度/时间.为了投票，
我们可能需要至少 2 天才能通过，但不超过 7 天.
这是可选的，即使设置，也可能被合同修改
(覆盖或只是强制执行最小/最大/默认值).

许多实现都希望限制谁可以提议.
也许只有投票集中的人.也许有一些
与提案一起交存的押金.这不是
在规范中，但对实现开放.

`Vote{proposal_id, vote}` - 给定一个proposal_id，你可以
投是、否、弃权或否决.每个签名可能有一个
投票中的不同“权重”，他们应用他们的
投票的全部权重.

许多合同(如典型的
具有绝对阈值的多重签名)可以考虑否决和
弃权为否，只算赞成票.与 quora 的合约
可以算作 quora 弃权，但不是阈值是或否.
一些合同可能赋予否决权而不是一个额外的权力
简单的不，但这可能就像正常的不投票一样.

`Execute{proposal_id}` - 这将检查投票
给定提案的条件已通过.如果有
成功，提案被标记为“已执行”，并且
消息被发送.如果消息失败(例如耗尽气体)，
这一切都恢复了，以后可以再试一次
更多的气体.

`Close{proposal_id}` - 这将检查投票条件
给定的提案失败.如果是这样(例如，时间已过
票数不足)，则提案被标记为“失败”.
这不是绝对必要的，因为它只会在
合同永远不可能被执行，
但可以触发以提供一些更好的 UI.

### 查询

`Threshold{}` - 返回有关所需规则的信息
宣布合同成功.得票率是多少
以及它们是如何计算的.

`Proposal{proposal_id}` - 返回信息集
创建提案以及当前状态.

`ListProposals{start_after, limit}` - 返回相同的信息
作为“提案”，但对于所有提案以及分页.
从proposal_id 1 开始并递增.

`ReverseProposals{start_before, limit}` - 返回相同的信息
作为“提案”，但对于所有提案以及分页.
从最晚的 proposal_id 开始并降序. (经常这个
是您想要的 UI)

`Vote{proposal_id,voter}` - 返回给定的
选民 (HumanAddr) 对该提案进行了投票. (可能为空)

`ListVotes{proposal_id, start_after, limit}` - 返回相同的信息
作为“投票”，但对于所有投票以及分页.
返回按选民地址排序的选民
字典序升序.

## 选民信息

谁可以投票的信息取决于合同.但
我们将使用一个通用 API 来显示其中的一些内容.

`Voter { address }` - 返回该地址的投票权(权重)，如果有的话

`ListVoters { start_after, limit }` - 列出所有符合条件的选民
