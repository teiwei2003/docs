# CW3柔軟なマルチシグニチャ

cw3-flex-multisigソースコード:[https://github.com/CosmWasm/cosmwasm-plus/tree/master/contracts/cw3-flex-multisig](https://github.com/CosmWasm/cosmwasm-plus/ツリー/メイン/コントラクト/cw3-flex-multisig)

これは[cw3-fixed-multisig](02-cw3-fixed-spec.md)に基づいています
[cw3仕様](01-spec.md)の強力な実装.
これは、
[cw4(グループ)](../cw4/01-spec.md)契約、独立
投票者セットを維持します.

これには2つの主な利点があります.

*投票しきい値が異なる2つの異なるマルチ署名を作成できます
  同じグループのサポートを受けてください.つまり、投票の50％と67％を獲得できます.
  同じ投票者のセットが常に使用されますが、他のアクションを実行できます.
* TODO:動的なマルチシグニチャグループを許可します.グループを変更できるので、
  マルチシグの1つを結合契約の管理者として設定できます.
  と

動的投票セットに加えて、ネイティブとの主な違い
Cosmos SDK multisigは、アグリゲーションチェーンの署名です.
要件ではなく、目に見える提案(CosmosSDKの「x/gov」など)
署名者は署名をオフチェーンで共有します.

## 中身

このマルチシグニチャを作成する最初のステップは、cw4コントラクトをインスタンス化することです
必要なメンバーのセットを用意します.現在、これはサポートされているだけです
[cw4-group](../cw4/02-cw4-group-spec.md)ですが、トークン加重グループ契約を追加します
(やれ).

「cw4-group」契約を作成し、マルチシグニチャができることを期待する場合
独自のグループを変更するには、複数のトランザクションで次の手順を実行します.

* init cw4-group、管理者として個人キーを使用します
*グループを指すマルチシグニチャを初期化します
* `AddHook {multisig}`は結合された予定にあります
*結合された予定の `UpdateAdmin {multisig}`

これは、このような循環依存関係を作成する現在の慣行です.
そして、外部ドライバーに依存します(そのようなスクリプトを書くことは困難または不可能ですらあります
チェーン上の自己展開契約). (TODO:より良い記録).

マルチシグニチャを作成するときは、投票に合格するために必要な重みを設定する必要があります
そして、最大/デフォルトの投票期間. (TODO:より多くのしきい値タイプを許可します)

## 処理

まず、登録済みの有権者は提案を提出する必要があります.これには、
スポンサーは最初に提案に「はい」と投票しました.提案者は設定できます
投票プロセスの有効期限、またはデフォルトの制限
契約が作成されたときに提供されます(したがって、プロポーザルは数回後に閉じることができます
空).

提案の有効期限が切れる前に、重みがゼロ以外の有権者は、
投票. 「はい」の投票のみがカウントされます.以前に十分な「はい」の投票が提出されている場合
提案の期日であり、ステータスは「承認済み」に設定されます.

提案が「合格」すると、誰でも「実行」メッセージを送信できます.この意志
プロポーザルをトリガーして、プロポーザルに保存されているすべてのメッセージを送信し、更新します
ステータスは「実行済み」であるため、再度実行することはできません. (実行が失敗した場合は注意してください
何らかの理由で-燃料不足、資金不足など-ステータスの更新は
復元された場合、「合格」のままになるため、再試行できます).

提案の有効期限が切れて合格しなかった場合、誰でも「閉じる」ために提案を送信できます
閉じたメッセージとしてマークします. UI/データベースのクリーンアップを除けば、これは効果がありません.
