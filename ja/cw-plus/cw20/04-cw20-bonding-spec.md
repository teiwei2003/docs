# CW20結合曲線

cw20-bonding-curveソースコード:[https://github.com/CosmWasm/cosmwasm-plus/tree/master/contracts/cw20-bonding](https://github.com/CosmWasm/cosmwasm-plus/tree/メイン/コントラクト/cw20-ボンディング)

これは[基本的なCW20インターフェース](01-spec.md)に基づいています
[`cw20-base`](02-cw20-base-spec.md)に実装されています

これには3つの目的があります。

*あらゆるボンディングカーブで利用可能でスケーラブルな契約
* `cw20-base`を拡張して機能を追加する方法を示します
* [Receiver Interface](01-spec.md#receiver)のデモンストレーション

## 設計

2つのバリエーションがあります-ネイティブトークンを受け入れるとcw20トークンを受け入れる
*予約*トークンとして(これは結合曲線に入力されたトークンです)。

ミンティング:入力がコントラクトに送信されたとき( `HandleMsg :: Buy()`を介して
ネイティブトークンを使用するか、 `HandleMsg :: Receive {}`)を介してcw20トークンを使用します。
これらのトークンはコントラクトに保持され、コントラクトに独自のトークンを発行します
送信者のアカウント(*供給*トークンと呼ばれます)。

書き込み:要求されたトークンを書き込むだけでなく、書き込み機能についても説明しました。
ただし、焼き付けられたアカウントに適切な量の入力トークンを解放する
カスタムトークン

曲線: `handle`は結合関数を指定し、それをパラメーター化に送信します
`handle_fn`(すべての作業を完了します)。コンパイル時に曲線を設定する
契約する。実際、多くの契約では、 `cw20-bonding`と
カスタム曲線パラメータを指定します。

[結合曲線の数学はこちら](https://yos.io/2018/11/10/bonding-curves/)についてもっと読む

注:最初のバージョンは、ネイティブトークンのみを受け入れます。

### 算数

価格曲線f(x)= x番目のトークンの価格が与えられた場合、次のように計算します。
債券カーブから売買する方法。実際に見てみることができます
発行された総供給量。 `F(x)`を `f(x)`の積分とします。送りました
コントラクトに送信された「F(x)」の「x」トークン。または、逆に、
コントラクトへの `x`トークン、それは` F ^ -1(x) `トークンをミントします。

これから、いくつかの数式を作成できます。すでに `S`をリリースしたとしましょう
トークンは「N = F(S)」入力トークンと交換されます。誰かが私たちに `x`トークンを送った場合、
いくつ発行しますか？

`F ^ -1(N + x)-F ^ -1(N)` = `F ^ -1(N + x)-S`

`x`トークンを販売すると、いくら取得できますか。

`F(S)-F(S-x)` = `N-F(S-x)`

両側で1つだけカウントされます。安全のため、必ず切り上げて
`F ^ -1(S)`を使用して金額を見積もる場合は、常に `F(S)`を確認してください。
発行する必要があります。これにより、トークンの数も安全に返されます。

組み込みのサポートは安全に[i128を整数乗](https://doc.rust-lang.org/std/primitive.i128.html#method.checked_pow)。
クレート[すべての整数にn個のルートを提供](https://docs.rs/num-integer/0.1.43/num_integer/trait.Roots.html)もあります。
これらの2つを使用すると、対数/指数を除くほとんどの数学を処理できます。

これを[信頼できる方法ですべてを書く](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/7b7ff729b82ea73ea168e495d9c94cb901ae95ce/contracts/math/Power.sol)と比較してください

例:

価格定数: `f(x)= k`および` F(x)= kx`および `F ^ -1(x)= x/k`

価格の線形性: `f(x)= kx`および` F(x)= kx ^ 2/2`および `F ^ -1(x)=(2x/k)^(0.5)`

価格の平方根: `f(x)= x ^ 0.5`および` F(x)= x ^ 1.5/1.5`および `F ^ -1(x)=(1.5 * x)^(2/3)`

これらの曲線は最初にのみ実装し、他の人がより複雑な曲線を使用してインポートできるようにします。
